<!DOCTYPE html>
<html>

<head>
  <link rel="stylesheet" href="css/bootstrap.min.css" type="text/css" />
  <link rel="stylesheet" href="css/jquery.toast.css">

  <audio id="sound" src="beep-07.mp3" controls="controls" class="hidden">

</audio>
  <meta charset=UTF-8>
  <style type="text/css">
    .table-sortable tbody tr {
      cursor: move;

    }

    .container {
      position: absolute;
      left: 5px;
      top: 55px;
      min-width: 10px;
      font-size: 1.2em;
      font-family: Arial
    }

    .btn-LeftSide {
      position: absolute;
      top: 2px;
      right: 2px;
    }

    .btn-centerSide {
      position: absolute;
      top: 2px;
      left: 45%;
    }

    .text_center {
      text-align: center;
      line-height: 100px;
      font-size: 1em;

    }

    .intext_center {
      position: relative;
      text-align: center;
      padding: 1px;
      top: -5px;

    }

    .intext_button {
      position: relative;
      text-align: center;
    }

    .btn-filter {
      position: relative;
      top: -20px;
      right: -10px;
    }



    .inputText {
      font-size: 1em;
      font-family: Arial;
      font-weight: 550;
    }

    .btn-sm {
      padding: 3px 15px;
      margin: 3px;
      font-size: 18px;
      line-height: 10px;
      -webkit-border-radius: 8px;
      -moz-border-radius: 8px;
      border-radius: 8px;
    }

    .dropdown-menu {
      border-radius: 8px;
      padding: 0px 0px;
    }
  </style>
  </style>
</head>

<body>
  <div id="content"></div>
  <nav class="navbar navbar-default">
    <div class="container-fluid">
      <!-- Brand and toggle get grouped for better mobile display -->
      <div class="navbar-header">
        <div class="btn-centerSide">
          <a href="#" class="btn btn-lg btn-success allStartTrigger"><span class="glyphicon glyphicon-play"></span></a>
          <a href="#" class="btn btn-lg btn-warning allPauseTrigger"><span class="glyphicon glyphicon-pause"></span></a>
          <a href="#" class="btn btn-lg btn-danger allResetTrigger"><span class="glyphicon glyphicon-stop"></span></a>
          <a href="#" class="btn btn-lg btn-success button11"><span class="glyphicon glyphicon-bell "></span></a>
        </div>

        <button class="btn btn-info btn-lg dropdown-toggle btn-LeftSide" type="button" data-toggle="dropdown">
  <span class="glyphicon glyphicon-list "></span></button>
        <ul class="dropdown-menu dropdown-menu-right">
          <li><a href="#" class="btn btn-sm btn-default saveClick"><span class="glyphicon glyphicon-floppy-disk"></span> SAVE</a></li>
          <li><a href="#" class="btn btn-sm btn-default loadClick"><span class="glyphicon glyphicon-folder-open"></span> LOAD</a></li>
          <li><a href="#" id="downloadClick" class="btn btn-sm btn-default downloadClick "><span class="glyphicon glyphicon-download-alt"></span> Download</a></li>
        </ul>


        </span>
        </a>
        <a class="navbar-brand" href="#">CountDown</a>
      </div>
      <!-- /.navbar-collapse -->
    </div>
    <!-- /.container-fluid -->
  </nav>

  <div class="container">
    <div class="row">
      <div class="col-md-8 table-responsive ">
        <table class="table  table-bordered table-condensed table-hover table-sortable" id="tab_logic">
          <thead>
            <tr style="background-color:#0099e6;">

              <div class="row-7" style=" position: relative;top:20.5px;">
                <div class="panel panel-primary filterable">
                  <div class="panel-heading">
                    <h3 class="panel-title">My CountDown</h3>

                  </div>

                </div>
              </div>

            </tr>
            <tr>
              <th class="intext_center" style="width: 12%;">
                #
              </th>
              <th class="intext_center">
                Description
              </th>
              <th class="intext_center" style="width: 16%">
                Hours
              </th>
              <th class="intext_center" style="width: 18%">
                Minutes
              </th>
              <th class="intext_center" style="width: 18%">
                Seconds
              </th>

              <td data-name="plus" id="add_row" class="intext_button" style="background-color:white">
                <button class='btn btn-success glyphicon glyphicon-plus btn-md'></button>
              </td>

            </tr>

          </thead>
          <tbody>
            <tr id='addr1' data-id="1">
              <td data-name="#">
                <input type="text" id="#" name='#' placeholder='#' class="form-control text_center inputText inputNumber" />
              </td>
              <td data-name="Description">
                <input type="text" id="description" name='description1' placeholder='Description' class="form-control text_center Description inputText" />
              </td>
              <td data-name="Hours">
                <input type="text" id="hours1" name='hours' placeholder='Hours' class="form-control text_center countHours inputText" value=1>
              </td>
              <td data-name="Minutes">
                <input type="text" id="minutes1" name='minutes' placeholder="Minutes" class="form-control text_center countMinutes inputText" value=0 />
              </td>
              <td data-name="Seconds">
                <input type="text" id="seconds1" name='seconds' placeholder="Seconds" class="form-control text_center countSeconds inputText" value=0 />
              </td>

              <td data-name="del">
                <button name="del0" class='btn btn-danger glyphicon glyphicon-remove row-remove'></button>
              </td>

            </tr>
          </tbody>
        </table>
      </div>
    </div>


    <div id=debug class="hidden">123</div>
    <div id=debug1 class="hidden">123</div>

    <script type="text/javascript" src="js/jquery-3.3.1.js"></script>
    <script type="text/javascript" src="js/Sortable_Table.js"></script>
    <script type="text/javascript" src="js/bootstrap.min.js"></script>
    <script type="text/javascript" src="js/jquery-ui.min.js"></script>
    <script type="text/javascript" src="js/jquery.toast.js"></script>




    <script>
      $(document).ready(function() {


        function showToast(heading, message) {
          $.toast({
            text: message, // Text that is to be shown in the toast
            heading: heading, // Optional heading to be shown on the toast
            icon: 'warning', // Type of toast icon
            showHideTransition: 'fade', // fade, slide or plain
            allowToastClose: true, // Boolean value true or false
            hideAfter: 2000, // false to make it sticky or number representing the miliseconds as time after which toast needs to be hidden
            stack: 50, // false if there should be only one toast at a time or a number representing the maximum number of toasts to be shown at a time
            position: 'bottom-right', // bottom-left or bottom-right or bottom-center or top-left or top-right or top-center or mid-center or an object representing the left, right, top, bottom values
            textAlign: 'left', // Text alignment i.e. left, right or center
            loader: true, // Whether to show loader or not. True by default
            loaderBg: '#9ec600', // Background color of the toast loader
            beforeShow: function() {}, // will be triggered before the toast is shown
            afterShown: function() {}, // will be triggered after the toat has been shown
            beforeHide: function() {}, // will be triggered before the toast gets hidden
            afterHidden: function() {} // will be triggered after the toast has been hidden
          });
        }

        var count = 0;
        $(".button11").click(function() {
          count++;
          var isEven = function(someNumber) {
            return (someNumber % 2 == 0) ? true : false;
          };
          if (isEven(count) == false) {
            audioElement.volume = 0
          }
          else if (isEven(count) == true) {
            audioElement.volume = 1
          }
        });

        $('.button11').click(function() {
          $(this).toggleClass('btn-success').toggleClass('btn-danger');
        });


        var audioElement = document.createElement('audio');
        audioElement.setAttribute('src', 'beep-07.mp3');


        $('#debug').click(function() {
          audioElement.play();
        });
        $('#debug1').click(function() {
          audioElement.pause();
        });
        $('.saveClick').click(function() {
          getNowTable()
        })
        $('.loadClick').click(function() {
          setSaveTable()
        })
        $('.downloadClick').click(function() {
          downloadJSON()
        })



        function timerStart() {
          var rowCount = $('#tab_logic tr .countHours').length;
          for (var i = 0; i < rowCount; i++) {
            h = $(".countHours").eq(i).val()
            m = $(".countMinutes").eq(i).val()
            s = $(".countSeconds").eq(i).val()



            if (s == 0 && m == 0 && h == 0) {
              $("#debug").trigger("click");
            }





            current = (h * 3600) + (m * 60) + s; //the current time left in seconds
            if (current > 0 && trigger == true) {
              //take one second away, and rerender the seconds split into d, h, m, and s in the html, which you will reuse next time timer() runs
              if (s > 0) {
                $(".countSeconds").eq(i).val(s - 1)
                $(".countMinutes").eq(i).val(m);
                $(".countHours").eq(i).val(h);
              }
              else if (m <= 0) {
                h--;
                m = 59;
                s = 59;
                $(".countSeconds").eq(i).val(s);
                $(".countMinutes").eq(i).val(m);
                $(".countHours").eq(i).val(h);
              }
              else {
                m--;
                s = 59;
                $(".countSeconds").eq(i).val(s);
                $(".countMinutes").eq(i).val(m);

              }

            }


            if ($(".countHours").eq(i).val(h) == 0) {
              clearInterval(timer); //Time's up clearInterval
            }
          } //Start_i-row_function
        } //Timer_Start_function
        function timerPause() {
          clearInterval(myVar);

        } //Timer_Pause_function
        function timerReset() {
          $(".form-control").not(".Description").val("")
          clearInterval(myVar);
        } //Timer_Reset_function

        var rowCount
        var myVar;
        var trigger = false;

        function allStartTrigger() {
          $(".allStartTrigger").unbind('click').one("click", function() {
            showToast("Hint", "All CountDown Start");
            trigger = true;
            myVar = setInterval(timerStart, 1000);
            //$('.form-control').prop('readonly', true);

          })
        }

        function allPauseTrigger() {
          $(".allPauseTrigger").click(function() {
            showToast("Hint", "All CountDown Pause");
            timerPause();
            $('.form-control').prop('readonly', false);
            allStartTrigger();



          })
        }

        function allResetTrigger() {
          $(".allResetTrigger").click(function() {
            showToast("Hint", "All CountDown Reset");
            timerReset();
            trigger = false;
            $('.form-control').prop('readonly', false);
          })

        }

        $(".allStartTrigger").click(allStartTrigger())
        $(".allPauseTrigger").click(allPauseTrigger())
        $(".allResetTrigger").click(allResetTrigger())

        var rowCount = $('#tab_logic tr .countHours').length;

        var requestURL = 'https://lab-pdgf557872.c9users.io/MySmallProject/backup.json';
        var request = new XMLHttpRequest();
        request.open('GET', requestURL);

        request.responseType = 'json';
        request.send();

        var timerJSON
        request.onload = function() {
          timerJSON = request.response;
          setTimeout(setDefaultJSON(timerJSON), 1000)
        }


        function setDefaultJSON(jsonObj) {
          for (var j = 1; j < timerJSON[0].length - 1; j++) {
            $("#add_row").trigger("click");

          }
          localStorage.clear()
          var rowCount = $('#tab_logic tr .countHours').length;
          for (var i = 0; i < rowCount; i++) {
            $(".inputNumber").eq(i).val(jsonObj[0][i])
            $(".Description").eq(i).val(jsonObj[1][i])
            $(".countHours").eq(i).val(jsonObj[2][i])
            $(".countMinutes").eq(i).val(jsonObj[3][i])
            $(".countSeconds").eq(i).val(jsonObj[4][i])
          }



        }

        var objinputNumber = []
        var objDescription = []
        var objCountHours = []
        var objCountMinutes = []
        var objCountSeconds = []

        function getNowTable() {
          var rowCount = $('#tab_logic tr .countHours').length;
          objinputNumber = [];
            objDescription = [];
            objCountHours = [];
            objCountMinutes = [];
            objCountSeconds = [];
          for (var i = 0; i < rowCount; i++) {
            var inputNumber = $(".inputNumber").eq(i);
            var Description = $(".Description").eq(i);
            var countHours = $(".countHours").eq(i);
            var countMinutes = $(".countMinutes").eq(i);
            var countSeconds = $(".countSeconds").eq(i);
            objinputNumber[i] = inputNumber.val();
            objDescription[i] = Description.val()
            objCountHours[i] = countHours.val();
            objCountMinutes[i] = countMinutes.val();
            objCountSeconds[i] = countSeconds.val();
          }
          var myJsonString = JSON.stringify([objinputNumber, objDescription, objCountHours, objCountMinutes, objCountSeconds])
          window.localStorage.setItem("myTimerkey", myJsonString);
          var obj = JSON.parse(localStorage.getItem('myTimerkey'));
          console.log(myJsonString)
        }

        function setSaveTable() {
          var rowCount = $('#tab_logic tr .countHours').length;
          var obj = JSON.parse(localStorage.getItem('myTimerkey'));
          if (rowCount > obj[0].length) {
            for (var i = rowCount; i >= obj[0].length; i--) {
              $(".row-remove").eq(i).trigger("click");
            }
          }
          if (rowCount <= obj[0].length) {
            for (var i = 0; i < obj[0].length - rowCount; i++)
              $("#add_row").trigger("click");
          }
          if (rowCount = obj[0].length) {
            for (var i = 0; i < rowCount; i++) {
              $(".inputNumber").eq(i).val(obj[0][i]);
              $(".Description").eq(i).val(obj[1][i])
              $(".countHours").eq(i).val(obj[2][i]);
              $(".countMinutes").eq(i).val(obj[3][i]);
              $(".countSeconds").eq(i).val(obj[4][i]);
            }
          }
        }

        function downloadJSON() {
          var obj = JSON.parse(localStorage.getItem('myTimerkey'));
          var json = JSON.stringify(obj);
          var blob = new Blob([json], { type: "application/json" });
          var url = URL.createObjectURL(blob);

          var a = document.createElement('a');
          a.download = "backup.json";
          a.href = url;
          // a.textContent = "Download backup.json";
          document.getElementById('downloadClick').download = "backup.json";
          document.getElementById('downloadClick').href = url;
        }


      });
    </script>

</body>

</html>
